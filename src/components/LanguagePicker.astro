---
import { languages } from "../i18n/ui";
import { getLangFromUrl } from "../i18n/utils";

interface Props {
    translatedPaths?: Record<string, string>;
    theme?: "light" | "dark";
}

const { translatedPaths, theme = "light" } = Astro.props;
const lang = getLangFromUrl(Astro.url);

function getPathProps(locale: string) {
    if (translatedPaths && translatedPaths[locale]) {
        return translatedPaths[locale];
    }

    const currentPath = Astro.url.pathname;

    // Logic to construct the new path
    // If current is /es/foo -> /en/foo
    // If current is /foo -> /en/foo (if default is es)
    // If current is /en/foo -> /foo (if migrating to es default)

    // Simplified logic relying on logic that 'es' is root for us
    if (locale === "es") {
        // Remove /en if present
        return currentPath.replace(/^\/en/, "") || "/";
    } else {
        // Add /en if not present
        if (currentPath.startsWith("/en")) return currentPath;
        // If it's just slash, return /en/
        if (currentPath === "/") return "/en/";
        return `/en${currentPath}`;
    }
}
---

<div class="flex items-center space-x-1 text-sm font-medium">
    {
        Object.entries(languages).map(([label, name]) => (
            <a
                href={getPathProps(label)}
                class:list={[
                    "transition-colors duration-200 p-2 rounded-md",
                    label === lang
                        ? theme === "dark"
                            ? "text-white font-bold bg-white/10"
                            : "text-teal-700 font-bold bg-teal-50"
                        : theme === "dark"
                          ? "text-stone-300 hover:text-white hover:bg-white/5"
                          : "text-stone-500 hover:text-teal-600 hover:bg-stone-100",
                ]}
                aria-label={`Switch to ${name}`}
            >
                {label.toUpperCase()}
            </a>
        ))
    }
</div>
